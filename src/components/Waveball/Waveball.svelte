<script context="module">
//import anime from 'animejs';
//import animate from './animation.js';
//import animate from './animation.store.js';
import { interpolate } from 'polymorph-js';
import { tweened } from 'svelte/motion';
import { cubicOut } from 'svelte/easing';
import { toFrom } from './motion.js';
import { tick } from 'svelte';
import forEach from '../../helpers/for-each.js';
import reverseArray from '../../helpers/reverse-array.js';

export async function preload() {
    return { fromGroup, toGroup };
}

</script>

<script>
    import { onMount, onDestroy } from 'svelte';
    export let width = 600;
    export let height = 600;
    export let outterStrokeWidth = 5;
    export let lineWidthsFront = 2;
    export let lineWidthsBack = .5;
    export let lineColorFront = "#90FFD7";
    export let lineColorBack = "#3EB8BB";
    export let id = "waveball";
    let className = '';
    export { className as class };

    let timeline;
    let fromGroup;
    let toGroup;
    let paths;
    let tPath2;
    let notween = (f,t) => () => t;
    let tween = (f,t) => interpolate([f,t]);

    let animOpts = {
        easing: t => t,
        duration: i =>
            Math.min(5, i) * 200 + 18000,
        delay: i => Math.min(8, i) * 300,
        alternate: false,
        autoplay: false,
        repeat: false
    };

    let animation = toFrom(
        {
            from: [],
            to: [],
            ...animOpts
        },
        {
            duration: 1000,
            easing: cubicOut,
            interpolate: notween
        }
    );

    let groups = [];

    const gatherPaths = function(fromGroup, toGroup) {
        const to = [];
        const from = [];
        forEach(fromGroup, (path, i) => {
            to.push(
                path.getAttribute('d'),
            );
            from.push(
               toGroup[i].getAttribute('d')
            )
        });
        return {from, to};
    }

    const toggle_play = function() {
        animation.play();
    }

    $: if ($animation[0] && typeof $animation[0] === 'string') {
        forEach(reverseArray(toGroup.children), (path, i) => {
            if (typeof $animation[i] === 'string') {
                path.setAttribute('d', $animation[i]);
            }
        })
    }

    onMount(()=> {
        if (typeof window !== 'undefined') {
            groups = gatherPaths(fromGroup.children, toGroup.children);

            animation.update(
                {
                    ...groups,
                    ...animOpts
                }
            );
            // animation.update(
            //     {
            //         ...groups,
            //         ...animOpts
            //     }
            // )

            window.anim = {
                $animation,
                animation
            };

            //console.log(fromGroup, toGroup, groups);
            //});

            // timeline = animate(
            //     fromGroup,
            //     toGroup
            // );


            // if (window.timeline) {
            //     window.timeline._stop();
            // }

            // timeline = animate(
            //     anime,
            //     fromGroup,
            //     toGroup
            // );

            // timeline.play();

            // window.timeline = timeline;
            // window.anime = anime;

        }

        //console.log(anime.running);
    });

    // onDestroy(() => {
    //     timeline && timeline._stop();
    // });
</script>

<style>
    svg {
        max-width: 100%;
        min-height: 1px;
        height: auto;
    }
    .paths {
        transform-origin: center;
    }

    .paths--to {
        transform: rotate(181deg);
        animation: to-rotate 50.23s infinite alternate
            ease-in-out;
    }

    .paths--from {
        transform: rotate(37deg);
        animation: from-rotate 48.89s infinite alternate
            ease-in-out;
    }

    @keyframes to-rotate {
        0% {
            transform: rotate(181deg);
        }
        100% {
            transform: rotate(227deg);
        }
    }

    @keyframes from-rotate {
        0% {
            transform: rotate(7deg);
        }
        100% {
            transform: rotate(31deg);
        }
    }
</style>
<svg xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    class="{className}"
    id="{id}"
    width="{width}px"
    viewBox="0 0 380 380"
    on:click={toggle_play}>
	<g display="inline">
        <defs>
            <circle id="{id}-clip"
                cx="190" cy="190" r="157"/>
            <clipPath id="{id}-mask">
                <use xlink:href="#{id}-clip" overflow="visible"/>
            </clipPath>
        </defs>
		<g fill="none"
            stroke-miterlimit="10"
            stroke="{lineColorBack}"
            stroke-width="{outterStrokeWidth}px">

            <use xlink:href="#{id}-clip" overflow="visible"/>

            <g id="{id}__paths--to"
               class="{id}__paths paths paths--to"
               clip-path="url(#{id}-mask)"
               stroke-width="{lineWidthsBack}px"
               bind:this={fromGroup}>
                <path class="p0t"
                    d="M726.5,-1321.5c-82.4,40.49,102.42,433,29,485c-73.98,52.4,-463.84,-578.73,-552,-562c-85.06,16.15,263.03,695.79,191,745c-72.87,49.78,-348.45,-381.02,-428,-340c-80.42,41.46,227.33,716.02,142,741c-85.17,24.93,-313.64,-320.23,-379,-261c-64.71,58.64,204.73,627.21,120.96,655.32c-88.56,29.73,-259.38,-334.37,-344.96,-292.32"></path>
                <path class="p1t"
                    d="M908.5,-1285.5c-82.4,40.49,-24.58,460,-98,512c-73.98,52.4,-354.84,-493.73,-443,-477c-85.06,16.15,213.03,648.79,141,698c-72.87,49.78,-351.45,-379.02,-431,-338c-80.42,41.46,205.33,636.02,120,661c-85.17,24.93,-314.64,-289.23,-380,-230c-64.71,58.64,103.77,533.88,20,562c-88.56,29.73,-218.42,-217.05,-304,-175"></path>
                <path class="p2t" bind:this={tPath2}
                    d="M879.5,-1108.5c-82.4,40.49,4.42,401,-69,453c-73.98,52.4,-308.84,-459.73,-397,-443c-85.06,16.15,130.03,590.79,58,640c-72.87,49.78,-329.45,-328.02,-409,-287c-80.42,41.46,173.33,572.02,88,597c-85.17,24.93,-233.64,-316.23,-299,-257c-64.71,58.64,74.77,498.88,-9,527c-88.56,29.73,-206.42,-201.05,-292,-159"></path>
                <path class="p3t"
                    d="M861.5,-895.5c-82.4,40.49,-1.42,281.64,-78,316c-78,35,-267.84,-440.73,-356,-424c-85.06,16.15,87.03,585.79,15,635c-72.87,49.78,-302.45,-281.02,-382,-240c-80.42,41.46,168.33,512.02,83,537c-85.17,24.93,-204.64,-324.23,-270,-265c-64.71,58.64,66.77,488.88,-17,517c-88.56,29.73,-220.42,-184.05,-306,-142"></path>
                <path class="p4t"
                    d="M168.5,-1535.5c-46.06,66.35,127,592,97,635c-27.81,39.86,-89.81,-197.59,-141,-198c-104.11,-0.84,14,465,-109,380c-43.73,-30.22,-90,-69,-88,19c1.52,66.9,94.39,423.82,60,461c-37,40,-106,-128,-108,-3c-0.86,53.86,42,363,-47,402c-63.35,27.76,-159.6,-140.64,-201,-81"></path>
                <path class="p5t"
                    d="M24.5,-1676.5c-46.06,60.02,107.2,462.57,61,485c-41,19.9,-110,-31.42,-132,-7c-65.77,73.02,119,403.05,87,451c-27.48,41.17,-108,-77.14,-130,-31c-26.51,55.58,166.39,745.37,132,779c-37,36.18,-113,-143.27,-116,-32c-2.67,99.17,144,352.72,55,388c-63.35,25.11,-127,-134,-144,-27"></path>
                <path class="p6t"
                    d="M217.5,-1513.5c-123,-17,12,586,11,621c-1.84,64.49,-61,52,-99,67c-91.4,36.08,-3,304.05,-35,352c-27.48,41.17,-50.81,-15.63,-79,27c-41,62,130,507,83,566c-25.61,32.15,-53,-74,-87,-41c-41.92,40.68,45.53,256.14,27,294c-23,47,-88,-38,-132,2"></path>
                <path class="p7t"
                    d="M326.5,-1374.5c-148,15,63.2,802.6,28,840c-32,34,-82,-55,-116,-7c-96.68,136.49,27,348,-20,420c-27.05,41.44,-71,-77,-96,-8c-21.33,58.88,57,298,11,333c-24.26,18.46,-59.99,-85.29,-94,-9c-37,83,82.87,210.65,-8,209c-55,-1,-45,-44,-81,-18"></path>
                <path class="p8t"
                    d="M676.5,-890.5c-148,-38,1,610,-136,662c-48.26,18.32,-101,-66,-165,-4c-120.14,116.38,-53,204,-91,288c-24.15,53.39,-75,-60,-100,9c-21.33,58.88,13,165,-23,191c-32.15,23.22,-76,-77,-102,20c-16.91,63.08,25,146,-25,173c-28.38,15.32,-58,-54,-83,-16"></path>
                <path class="p9t"
                    d="M870.5,-523.5c-148,-38,-214,568,-351,620c-48.26,18.32,-93.84,-55.59,-133,-41c-51,19,-30,77,-65,125c-30.89,42.36,-66.86,-60.83,-107,10c-17,30,-5,91,-43,105c-34.87,12.85,-60,-62,-96,4c-30.84,56.55,10.38,92.35,-26,136c-25,30,-47,61,-87,71"></path>
                <path class="p10t"
                    d="M396.8,194.57c-8.84,3.253,-14.851,8.519,-19.559,14.784c-4.708,6.265,-8.114,13.529,-11.742,20.779c-3.628,7.25,-7.479,14.487,-13.079,20.697c-18.83,20.87,-38.93,16.63,-60.86,5.55c-10.95,-5.535,-21.455,-9.368,-31.576,-9.206c-10.121,0.161,-19.859,4.316,-29.274,14.756c-16.69,18.51,-17.85,46.82,-44.38,56.26c-24.78,8.82,-37,-10.41,-58.62,-16.27c-13.37,-3.625,-24.217,-0.812,-33.18,5.544c-8.963,6.356,-16.04,16.256,-21.87,26.806c-12.02,21.77,-25.6,45.44,-55.12,39.78c-23.19,-4.45,-35.38,-26.91,-61.65,-17.25"></path>
                <path class="p11t"
                    d="M406.59,277.26c-18.4,2.59,-26.64,10.67,-34.89,18.76c-8.24,8.09,-16.49,16.17,-34.89,18.76c-18.4,2.59,-28.55,-2.91,-38.7,-8.41c-10.15,-5.5,-20.31,-11,-38.7,-8.41c-18.4,2.59,-26.64,10.67,-34.88,18.76c-8.24,8.09,-16.49,16.17,-34.88,18.76c-18.4,2.59,-28.55,-2.91,-38.7,-8.41c-10.15,-5.5,-20.31,-11,-38.7,-8.41c-18.4,2.59,-26.64,10.67,-34.88,18.76c-8.24,8.09,-16.49,16.17,-34.88,18.76c-18.4,2.59,-28.55,-2.91,-38.7,-8.41c-10.15,-5.5,-20.31,-11,-38.7,-8.41"></path>
                <path class="p12t"
                    d="M404.84,329.3c-17.86,0,-26.8,4.29,-35.73,8.57c-8.93,4.28,-17.86,8.57,-35.73,8.57c-17.87,0,-26.8,-4.29,-35.73,-8.57c-8.93,-4.28,-17.86,-8.57,-35.73,-8.57c-17.86,0,-26.79,4.29,-35.73,8.57c-8.94,4.28,-17.86,8.57,-35.73,8.57c-17.86,0,-26.79,-4.29,-35.72,-8.57c-8.93,-4.28,-17.86,-8.57,-35.72,-8.57c-17.86,0,-26.79,4.29,-35.73,8.57c-8.94,4.28,-17.86,8.57,-35.73,8.57c-17.86,0,-26.79,-4.29,-35.73,-8.57c-8.94,-4.28,-17.86,-8.57,-35.73,-8.5"></path>
            </g>
        </g>
        <g fill="none"
            stroke-miterlimit="10"
            stroke="{lineColorFront}"
            stroke-width="{outterStrokeWidth}px">

            <use xlink:href="#{id}-clip" overflow="visible"/>

            <g class="{id}__paths paths paths--from"
                id="{id}__paths--from"
                clip-path="url(#{id}-mask)"
                stroke-width="{lineWidthsFront}px"
                bind:this={toGroup}>
                <path class="p0f"
                    d="M1934.69,-10.47c-91.81,0,-169.52,33.97,-258.34,48.27c-89.51,14.4,-174.28,2.72,-260.79,-21.14c-83.46,-23.02,-163.39,-33.67,-249.74,-21.27c-87.35,12.55,-167.51,46.06,-257,47.79c-90.46,1.75,-170.66,-31.76,-258.26,-46.97c-87.44,-15.18,-174.52,-6.26,-259.3,18.08c-83.94,24.1,-165.06,36.51,-252.64,24.81c-92.59,-12.37,-174.08,-49.57,-269.43,-49.57"></path>
                <path class="p1f"
                    d="M1697.61,34.86c-85.4,0,-158.92,35.33,-241.97,46.21c-75.24,9.85,-146.07,-2.35,-218.24,-22.93c-75.95,-21.66,-149.35,-29.56,-227.83,-15.56c-78.4,13.99,-149.1,42.74,-230.31,41.1c-73.73,-1.49,-139.74,-30.99,-211.42,-43.31c-82.05,-14.1,-159.12,-1.85,-237.96,21.32c-72.12,21.19,-144.8,28.7,-219.44,16.47c-76.25,-12.5,-145.98,-43.3,-224.68,-43.3"></path>
                <path class="p2f"
                    d="M1489.64,76.07c-72.48,0,-133.59,29.63,-203.66,40.74c-71.05,11.26,-136.89,-1,-204.9,-21.08c-62.62,-18.48,-124.19,-24.81,-188.9,-13.87c-67.13,11.35,-127.51,37.97,-196.85,38.62c-71.04,0.66,-133.05,-29.08,-201.87,-40.28c-63.19,-10.28,-126.3,-3.69,-187.23,15.03c-67.23,20.65,-131.82,32.09,-202.36,21.26c-70.08,-10.76,-131.13,-40.42,-203.57,-40.42"></path>
                <path class="p3f"
                    d="M1307.21,113.54c-61,0,-110.67,23.75,-169.04,35.3c-57.86,11.45,-115.18,5.17,-171.15,-11.75c-58.56,-17.7,-113.32,-28.85,-174.85,-19.7c-61.51,9.14,-116.93,35.69,-180.19,36.53c-61.09,0.81,-113.74,-24.55,-172.54,-35.54c-61.87,-11.56,-121.12,-3.16,-180.36,15.83c-58.51,18.76,-117.01,25.94,-177.96,14.17c-57.24,-11.05,-108.52,-34.83,-168.06,-34.83"></path>
                <path class="p4f"
                    d="M1147.18,147.6c-56.74,0,-103.81,24.99,-158.47,33.86c-53.04,8.6,-101.93,-0.5,-152.42,-16.47c-49.04,-15.52,-96.14,-21.75,-147.3,-12.83c-52.88,9.21,-99.31,31.81,-154.17,32.11c-53.33,0.29,-98.84,-22.71,-150.14,-32.49c-50.63,-9.65,-100.92,-3.83,-149.52,12.14c-48.98,16.1,-95.9,25.31,-147.69,18.05c-55.75,-7.84,-105.8,-34.37,-163.23,-34.37"></path>
                <path class="p5f"
                    d="M1006.8,179.56c-51.45,0,-93.03,24.33,-142.54,31.2c-46.47,6.45,-88.86,-1.78,-132.39,-16.99c-46.64,-16.29,-98.3,-19.68,-146.25,-6.32c-44.67,12.45,-80.7,27.45,-128.55,25.26c-42.6,-1.95,-77.95,-21.52,-118.97,-29.29c-50.62,-9.58,-96.08,-0.68,-143.51,15.68c-43.01,14.84,-90.17,18.65,-134.83,8.66c-43.61,-9.76,-79.47,-28.2,-125.71,-28.2"></path>
                <path class="p6f"
                    d="M883.67,206.71c-42.25,0,-74.48,18.3,-114.46,26.55c-43.65,9,-84.26,1.4,-125.32,-13.1c-39.92,-14.09,-82.95,-18.35,-124.46,-7.72c-39.38,10.09,-70.41,25.55,-112.66,24.51c-40.03,-0.99,-71.7,-19.31,-109.91,-26.77c-40.77,-7.95,-80.51,-2.34,-118.96,11.72c-39.26,14.36,-80.24,19.95,-121.74,11.16c-39.59,-8.39,-71.63,-26.35,-113.51,-26.35"></path>
                <path class="p7f"
                    d="M775.66,232.29c-35.96,0,-62.97,15.22,-96.74,23.3c-37.35,8.94,-74.25,3.7,-109.59,-9.48c-35.92,-13.39,-73.66,-18.66,-111.51,-9.06c-37.44,9.5,-66.75,24.84,-107.15,22.53c-32.22,-1.84,-58.4,-17.59,-89.27,-23.98c-36.1,-7.47,-70.85,-2.1,-104.84,10.49c-35.4,13.11,-72.2,18.46,-109.63,9.49c-33.93,-8.12,-60.52,-23.3,-96.73,-23.3"></path>
                <path class="p8f"
                    d="M680.91,255.56c-29.76,0,-52.13,11.85,-79.78,19.79c-32.99,9.47,-66.89,5.88,-98.48,-6.1c-29.54,-11.21,-58.26,-17.25,-90.16,-11.52c-28.32,5.09,-52.32,20.46,-81.55,22.57c-34.25,2.47,-58.62,-9.39,-90.08,-18.89c-33.74,-10.18,-67.84,-6.26,-100.3,5.57c-32.28,11.77,-63.51,18.12,-97.98,9.9c-30.08,-7.17,-53.59,-21.33,-85.75,-21.33"></path>
                <path class="p9f"
                    d="M597.79,276.7c-28.32,0,-48.13,12.59,-74.44,19.26c-29.37,7.45,-56.83,2.58,-84.36,-7.85c-27.42,-10.38,-55.19,-15.33,-84.36,-7.85c-26.12,6.7,-46.4,19.26,-74.43,19.26c-26.4,0,-46.08,-11.03,-70.54,-18.08c-28.53,-8.23,-57.55,-5.14,-84.91,5.26c-27.49,10.45,-53.48,16.52,-83.25,10.2c-27.78,-5.9,-49.26,-20.2,-78.87,-20.2"></path>
                <path class="p10f"
                    d="M524.89,295.93c-13.145,0,-24.443,3.325,-35.534,7.311c-11.091,3.987,-21.976,8.634,-34.296,11.279c-25.38,5.45,-46.04,0.01,-69.46,-8.22c-26.25,-9.22,-50.49,-14.12,-78.19,-5.89c-10.685,3.175,-20.127,7.242,-29.815,10.516c-9.687,3.274,-19.62,5.754,-31.285,5.754c-23.29,0,-39.84,-9.94,-61.1,-16.27c-13.76,-4.095,-26.79,-4.987,-39.639,-3.674c-12.849,1.314,-25.516,4.834,-38.551,9.564c-23.09,8.38,-44.36,13.6,-69.46,8.22c-12.32,-2.645,-23.205,-7.292,-34.296,-11.279c-11.091,-3.986,-22.389,-7.311,-35.534,-7.311"></path>
                <path class="p11f"
                    d="M496.79,313.41c-20.36,0,-30.55,4.72,-40.73,9.43c-10.18,4.72,-20.36,9.43,-40.73,9.43c-20.36,0,-30.55,-4.72,-40.73,-9.43c-10.18,-4.71,-20.36,-9.43,-40.73,-9.43c-20.36,0,-30.55,4.72,-40.73,9.43c-10.18,4.71,-20.36,9.43,-40.73,9.43c-20.36,0,-30.54,-4.72,-40.73,-9.43c-10.19,-4.71,-20.36,-9.43,-40.73,-9.43c-20.36,0,-30.55,4.72,-40.73,9.43c-10.18,4.71,-20.36,9.43,-40.73,9.43c-20.36,0,-30.54,-4.72,-40.73,-9.43c-10.19,-4.71,-20.36,-9.43,-40.73,-9.43"></path>
                <path class="p12f"
                    d="M435.57,329.3c-17.86,0,-26.8,4.29,-35.73,8.57c-8.93,4.28,-17.86,8.57,-35.73,8.57c-17.87,0,-26.8,-4.29,-35.73,-8.57c-8.93,-4.28,-17.86,-8.57,-35.73,-8.57c-17.86,0,-26.79,4.29,-35.73,8.57c-8.93,4.29,-17.86,8.57,-35.73,8.57c-17.86,0,-26.79,-4.29,-35.72,-8.57c-8.93,-4.29,-17.86,-8.57,-35.72,-8.57c-17.86,0,-26.79,4.29,-35.73,8.57c-8.94,4.28,-17.86,8.57,-35.73,8.57c-17.86,0,-26.79,-4.29,-35.73,-8.57c-8.94,-4.28,-17.86,-8.57,-35.73,-8.57"></path>
            </g>
        </g>
	</svg>
